<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mis Gastos</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#7C7CFF">

<style>
:root{
  --primary:#7C7CFF;
  --bg:#F4F5FA;
  --card:#FFFFFF;
  --text:#1F2937;
  --muted:#6B7280;
}
body{
  margin:0;
  background:var(--bg);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}
.screen{display:none;padding-bottom:80px;}
.screen.active{display:block;}
header{padding:20px;}
h1{margin:0;}
.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
  margin:12px;
  box-shadow:0 10px 25px rgba(0,0,0,.05);
}
.big{
  font-size:32px;
  font-weight:700;
}
.muted{color:var(--muted);}
.progress{
  height:8px;
  background:#E5E7EB;
  border-radius:6px;
  overflow:hidden;
  margin-top:6px;
}
.progress div{
  height:100%;
  background:var(--primary);
}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:12px;
  border:1px solid #E5E7EB;
  font-size:15px;
}
button{
  background:var(--primary);
  color:white;
  border:none;
  font-weight:600;
}
nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:60px;
  background:white;
  display:flex;
  border-top:1px solid #E5E7EB;
}
nav button{
  flex:1;
  background:none;
  color:var(--muted);
}
nav button.active{
  color:var(--primary);
  font-weight:700;
}
</style>
</head>

<body>

<!-- üè† HOME -->
<div class="screen active" id="home">
  <header>
    <h1>Este mes</h1>
    <div class="big" id="available">0 ‚Ç¨</div>
    <div class="muted">Disponible</div>
  </header>

  <div class="card">
    <p>Ingresos: <strong id="incomeView">0 ‚Ç¨</strong></p>
    <p>Gastos: <strong id="expenseView">0 ‚Ç¨</strong></p>
  </div>

  <div id="categoryList"></div>
</div>

<!-- ‚ûï MOVIMIENTOS -->
<div class="screen" id="add">
  <header><h1>Movimiento</h1></header>

  <div class="card">
    <h3>Ingreso</h3>
    <input type="number" id="incomeInput" placeholder="Cantidad">
    <button onclick="setIncome()">Guardar ingreso</button>
  </div>

  <div class="card">
    <h3>Gasto</h3>
    <input type="number" id="expenseAmount" placeholder="Cantidad">
    <select id="expenseCategory"></select>
    <button onclick="addExpense()">A√±adir gasto</button>
  </div>

  <div class="card">
    <h3>Nueva categor√≠a</h3>
    <input type="text" id="newCategory" placeholder="Nombre">
    <button onclick="addCategory()">Crear</button>
  </div>
</div>

<!-- üìä HIST√ìRICO -->
<div class="screen" id="history">
  <header><h1>Hist√≥rico</h1></header>
  <div class="card">
    <select id="historySelect" onchange="renderHistory()"></select>
    <div id="historyContent"></div>
  </div>
</div>

<!-- NAV -->
<nav>
  <button class="active" onclick="show('home')">Inicio</button>
  <button onclick="show('add')">+</button>
  <button onclick="show('history')">Hist√≥rico</button>
</nav>

<script>
const monthKey=new Date().toISOString().slice(0,7);

let data=JSON.parse(localStorage.getItem("financeApp"))||{
  months:{},
  categoriesList:["Suscripciones","Salud","Belleza","Libros","Regalos","Alimentaci√≥n","Viajes","Restaurantes","Lego","Ocio"]
};

if(!data.months[monthKey]){
  data.months[monthKey]={income:0,categories:{}};
  data.categoriesList.forEach(c=>data.months[monthKey].categories[c]={budget:0,spent:0});
}

function save(){localStorage.setItem("financeApp",JSON.stringify(data));render();}

function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");
}

function setIncome(){data.months[monthKey].income=Number(incomeInput.value);save();}
function addExpense(){
  const a=Number(expenseAmount.value);
  const c=expenseCategory.value;
  data.months[monthKey].categories[c].spent+=a;
  save();
}
function addCategory(){
  const n=newCategory.value.trim();
  if(!n||data.categoriesList.includes(n))return;
  data.categoriesList.push(n);
  Object.values(data.months).forEach(m=>m.categories[n]={budget:0,spent:0});
  save();
}

function render(){
  const m=data.months[monthKey];
  const spent=Object.values(m.categories).reduce((a,c)=>a+c.spent,0);
  incomeView.textContent=m.income+" ‚Ç¨";
  expenseView.textContent=spent+" ‚Ç¨";
  available.textContent=(m.income-spent)+" ‚Ç¨";

  expenseCategory.innerHTML="";
  data.categoriesList.forEach(c=>{
    const o=document.createElement("option");o.textContent=c;expenseCategory.appendChild(o);
  });

  categoryList.innerHTML="";
  data.categoriesList.forEach(cat=>{
    const c=m.categories[cat];
    const pct=c.budget?Math.min(c.spent/c.budget*100,100):0;
    categoryList.innerHTML+=`
      <div class="card">
        <strong>${cat}</strong>
        <div class="muted">${c.spent} ‚Ç¨ / ${c.budget} ‚Ç¨</div>
        <input type="number" placeholder="Presupuesto"
          value="${c.budget}"
          onchange="data.months['${monthKey}'].categories['${cat}'].budget=this.value; save();">
        <div class="progress"><div style="width:${pct}%"></div></div>
      </div>`;
  });

  historySelect.innerHTML="";
  Object.keys(data.months).forEach(k=>{
    const o=document.createElement("option");o.textContent=k;historySelect.appendChild(o);
  });
}

function renderHistory(){
  const m=data.months[historySelect.value];
  let h=`<p>Ingreso: ${m.income} ‚Ç¨</p>`;
  Object.entries(m.categories).forEach(([k,v])=>{if(v.spent>0)h+=`<p>${k}: ${v.spent} ‚Ç¨</p>`});
  historyContent.innerHTML=h;
}

render();
</script>
</body>
</html>


